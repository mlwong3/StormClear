<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>風調雨順 - 災後維修 (模擬)</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 使用 Inter 字體 */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        /* 隱藏所有螢幕，預設 */
        .app-screen {
            display: none;
        }
        /* 顯示當前活動的螢幕 */
        .app-screen.active {
            display: flex;
        }
        /* 自訂滾動條 */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background-color: #f1f5f9;
        }
        /* 地圖容器 */
        .map-iframe-container {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 200px;
            overflow: hidden;
        }
        .map-iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }
        /* 列表點擊樣式 */
        .task-row:hover {
            background-color: #f9fafb;
            cursor: pointer;
        }
        /* 郊野公園選擇按鈕樣式 */
        .park-btn.selected {
            background-color: #eff6ff; /* blue-50 */
            border-color: #3b82f6; /* blue-500 */
            border-width: 2px;
        }
    </style>
</head>
<body class="bg-gray-800 p-4 md:p-8 flex items-center justify-center min-h-screen">

    <!-- 手機模擬器外框 -->
    <!-- (更新) 高度從 850px 改為 700px 以縮短頁面大小 -->
    <div class="w-full max-w-md mx-auto h-[700px] bg-white shadow-2xl rounded-3xl overflow-hidden border-4 border-gray-900 flex flex-col relative">

        <!-- 頂部空間 -->
        <div class="bg-white h-6 w-full flex-shrink-0"></div>

        <!-- 應用程式內容區域 -->
        <div class="flex-1 overflow-y-auto custom-scrollbar flex flex-col">

            <!-- ======================================== -->
            <!-- 1. 登入頁 (Login Screen) -->
            <!-- ======================================== -->
            <div id="screen-login" class="app-screen active flex-col h-full justify-center items-center p-8 bg-gray-50">
                <div class="text-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-blue-600"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mt-6 mb-12 text-center">風調雨順 - 災後維修</h1>
                <button onclick="showScreen('screen-public-home')" class="w-full bg-blue-600 text-white font-semibold py-4 px-6 rounded-lg text-lg shadow-md hover:bg-blue-700 transition duration-200 mb-4">
                    公眾人士
                </button>
                <button onclick="showScreen('screen-gov-login')" class="w-full bg-gray-700 text-white font-semibold py-4 px-6 rounded-lg text-lg shadow-md hover:bg-gray-800 transition duration-200">
                    政府部門
                </button>
            </div>

            <!-- ======================================== -->
            <!-- 1B. 政府部門登入頁 -->
            <!-- ======================================== -->
            <div id="screen-gov-login" class="app-screen flex-col h-full bg-gray-50">
                <header class="flex-shrink-0 bg-white p-4 flex items-center border-b">
                    <button onclick="showScreen('screen-login')" class="p-2 text-blue-600 w-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <h2 class="flex-1 text-center text-lg font-semibold text-gray-800">政府部門登入</h2>
                    <div class="w-10"></div>
                </header>
                <div class="flex-1 flex flex-col justify-center items-center p-8">
                    <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-700 mb-8"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><path d="m12 14 4-2"></path><path d="m12 14-4-2"></path><path d="m12 14-4 2"></path><path d="m12 14 4 2"></path><path d="m12 14-4-2"></path></svg>
                    <div class="w-full space-y-4">
                        <input type="text" placeholder="帳號" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="password" placeholder="密碼" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button onclick="showScreen('screen-gov-home')" class="w-full bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg text-lg shadow-md hover:bg-gray-800 transition duration-200 mt-4">
                            登入
                        </button>
                    </div>
                </div>
            </div>

            <!-- ======================================== -->
            <!-- 2. 公眾人士 - 主頁 -->
            <!-- ======================================== -->
            <div id="screen-public-home" class="app-screen flex-col h-full bg-gray-50">
                <header class="flex-shrink-0 bg-white p-4 flex items-center border-b">
                    <button onclick="showScreen('screen-login')" class="p-2 text-blue-600 w-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <h2 class="flex-1 text-center text-lg font-semibold text-gray-800">風調雨順(公眾人士)</h2>
                    <div class="w-10"></div>
                </header>
                <div class="flex-1 p-6 space-y-4">
                    <button onclick="showScreen('screen-news')" class="w-full bg-white p-6 rounded-lg shadow-md border border-gray-200 flex items-center space-x-4 hover:bg-gray-50 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                        <span class="text-xl font-semibold text-gray-700">NEWS 最新消息</span>
                    </button>
                    <button onclick="showScreen('screen-map')" class="w-full bg-white p-6 rounded-lg shadow-md border border-gray-200 flex items-center space-x-4 hover:bg-gray-50 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-600"><path d="M4 15.5A3.5 3.5 0 0 1 7.5 12H12"></path><path d="M14.5 12a3.5 3.5 0 0 1 3.5 3.5V19H14v-1.5a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 0-.5.5V19H8v-1.5A3.5 3.5 0 0 1 11.5 12H12"></path><path d="M14 19v-1.5a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 0-.5.5V19"></path><path d="M18 19v-1.5a.5.5 0 0 0-.5-.5h-2a.5.5 0 0 0-.5.5V19"></path><path d="M22 19v-1.5a.5.5 0 0 0-.5-.5H18"></path><path d="M2 19v-1.5a.5.5 0 0 1 .5-.5H6v2"></path><path d="M7 12V3.5A3.5 3.5 0 0 1 10.5 0H12"></path><path d="M14.5 0a3.5 3.5 0 0 1 3.5 3.5V12"></path></svg>
                        <span class="text-xl font-semibold text-gray-700">路面情況</span>
                    </button>
                    <button onclick="showScreen('screen-report')" class="w-full bg-white p-6 rounded-lg shadow-md border border-gray-200 flex items-center space-x-4 hover:bg-gray-50 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-600"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path><circle cx="12" cy="13" r="3"></circle></svg>
                        <span class="text-xl font-semibold text-gray-700">匯報情況</span>
                    </button>
                    <button onclick="showScreen('screen-report-history')" class="w-full bg-white p-6 rounded-lg shadow-md border border-gray-200 flex items-center space-x-4 hover:bg-gray-50 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-600">
                            <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
                            <path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
                            <path d="m10 15.5 4 4-4 4"></path>
                            <path d="m8 11.5 4-4 4 4"></path>
                        </svg>
                        <span class="text-xl font-semibold text-gray-700">我的匯報紀錄</span>
                    </button>
                </div>
            </div>

            <!-- ======================================== -->
            <!-- 3. 最新消息頁 -->
            <!-- ======================================== -->
            <div id="screen-news" class="app-screen flex-col h-full bg-gray-100">
                 <header class="flex-shrink-0 bg-white p-4 flex items-center border-b sticky top-0">
                    <button onclick="showScreen('screen-public-home')" class="p-2 text-blue-600 w-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <h2 class="flex-1 text-center text-lg font-semibold text-gray-800">最新消息</h2>
                    <div class="w-10"></div>
                </header>
                <div class="flex-1 p-4 space-y-4 overflow-y-auto custom-scrollbar">
                    <div class="bg-white rounded-lg shadow p-5">
                        <h3 class="text-xl font-bold text-red-600 mb-2">風暴提示</h3>
                        <p class="text-sm text-gray-500 mb-3">2025年9月2日 09:20</p>
                        <p class="text-gray-700 leading-relaxed">超強颱風「山馬」正持續逼近本港...</p>
                    </div>
                    <div class="bg-white rounded-lg shadow p-5">
                        <h3 class="text-xl font-bold text-yellow-600 mb-2">服務暫停安排</h3>
                        <p class="text-sm text-gray-500 mb-3">2025年9月2日 08:20</p>
                        <p class="text-gray-700 leading-relaxed">八號熱帶氣旋警告信號現正生效...</p>
                    </div>
                    <div class="bg-white rounded-lg shadow p-5">
                        <h3 class="text-xl font-bold text-blue-600 mb-2">政府跟進工作</h3>
                        <p class="text-sm text-gray-500 mb-3">2025年9月2日 10:30</p>
                        <p class="text-gray-700 leading-relaxed">因應超強颱風「山馬」來襲...</p>
                    </div>
                </div>
            </div>

            <!-- ======================================== -->
            <!-- 4. 路面情況頁 (地圖) -->
            <!-- ======================================== -->
            <div id="screen-map" class="app-screen flex-col h-full bg-gray-100">
                <header class="flex-shrink-0 bg-white p-4 flex items-center border-b sticky top-0 z-10">
                    <button onclick="showScreen('screen-public-home')" class="p-2 text-blue-600 w-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <h2 class="flex-1 text-center text-lg font-semibold text-gray-800">路面情況</h2>
                    <div class="w-10"></div>
                </header>
                <div class="flex-1 flex flex-col">
                    <div class="flex-1 relative bg-gray-300">
                        <div class="map-iframe-container">
                            <iframe class="map-iframe" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d14747.88610338779!2d113.9928509420892!3d22.46820129080789!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3403f0b26383a375%3A0x83209880ca02b662!2z5aSp5rC05ZyS!5e0!3m2!1szh-TW!2shk!4v1729825598380!5m2!1szh-TW!2shk" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                        </div>
                    </div>
                    <div class="flex-shrink-0 bg-white p-3 border-t-2 border-gray-200 shadow-inner">
                        <h4 class="font-semibold text-gray-700 mb-2">香港出行易 (模擬)</h4>
                        <div class="flex space-x-2 overflow-x-auto">
                            <div class="flex-shrink-0 w-40 bg-gray-100 p-2 rounded-lg">
                                <!-- 修改此處: 更換圖片連結 -->
                                <img src="https://placehold.co/160x90/666/fff?text=AID01215" alt="交通鏡頭" class="rounded mb-1">
                                <p class="text-xs text-gray-600 truncate">堅拿道天橋近永德大廈-南行</p>
                            </div>
                            <div class="flex-shrink-0 w-40 bg-gray-100 p-2 rounded-lg">
                                <!-- 修改此處: 更換圖片連結 -->
                                <img src="https://placehold.co/160x90/666/fff?text=H904F" alt="交通鏡頭" class="rounded mb-1">
                                <p class="text-xs text-gray-600 truncate">堅拿道天橋近告士打道</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ======================================== -->
            <!-- 5. 匯報情況頁 (公眾) -->
            <!-- ======================================== -->
            <div id="screen-report" class="app-screen flex-col h-full bg-gray-50">
                <header class="flex-shrink-0 bg-white p-4 flex items-center border-b">
                    <button onclick="showScreen('screen-public-home')" class="p-2 text-blue-600 w-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <h2 class="flex-1 text-center text-lg font-semibold text-gray-800">匯報情況</h2>
                    <div class="w-10"></div>
                </header>
                <div class="flex-1 p-8 flex flex-col space-y-4">
                    <input type="file" id="photo-upload" accept="image/*" capture="environment" class="hidden" onchange="previewPhoto(event)">
                    <div id="photo-preview" class="w-full h-40 bg-gray-200 rounded-lg flex items-center justify-center text-gray-500 border-2 border-dashed border-gray-300">
                        (相片預覽)
                    </div>
                    <button onclick="document.getElementById('photo-upload').click()" class="w-full bg-blue-100 text-blue-700 font-semibold py-3 px-6 rounded-lg text-lg border border-blue-300 hover:bg-blue-200 transition">
                        按此拍攝相片
                    </button>
                    
                    <!-- (更新) 區域選擇 -->
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">區域:</label>
                            <select id="region-select" onchange="updateDistricts()" class="w-full p-2 border border-gray-300 rounded-lg bg-white">
                                <option value="">請選擇</option>
                                <option value="香港島">香港島</option>
                                <option value="九龍">九龍</option>
                                <option value="新界">新界</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">地區:</label>
                            <select id="district-select" class="w-full p-2 border border-gray-300 rounded-lg bg-white" disabled>
                                <option value="">請先選區域</option>
                            </select>
                        </div>
                    </div>

                    <!-- 問題類型 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">問題類型:</label>
                        <select id="report-problem-type" class="w-full p-2 border border-gray-300 rounded-lg bg-white">
                            <option value="tree-fall">樹木倒塌</option>
                            <option value="flooding">嚴重水浸</option>
                            <option value_name="lamp-damage">燈柱損壞</option>
                            <option value="debris">路面雜物</option>
                            <option value="other">其他</option>
                        </select>
                    </div>
                    
                    <textarea id="report-textarea" class="w-full h-24 px-4 py-3 border border-gray-300 rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="詳細描述..."></textarea>

                    <button onclick="submitReport()" class="w-full bg-green-600 text-white font-bold py-4 px-6 rounded-lg text-lg shadow-md hover:bg-green-700 transition duration-200">
                        匯報
                    </button>
                </div>
            </div>

            <!-- ======================================== -->
            <!-- 匯報成功頁 -->
            <!-- ======================================== -->
            <div id="screen-report-success" class="app-screen flex-col h-full justify-center items-center p-8 bg-green-50">
                <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-500"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                <h2 class="text-3xl font-bold text-green-700 mt-6">匯報成功</h2>
                <p class="text-gray-600 text-lg mt-2">感謝您的回報！</p>
                <p class="text-gray-500 text-sm mt-4">正在返回主頁...</p>
            </div>

            <!-- ======================================== -->
            <!-- 我的匯報紀錄頁 -->
            <!-- ======================================== -->
            <div id="screen-report-history" class="app-screen flex-col h-full bg-gray-100">
                <header class="flex-shrink-0 bg-white p-4 flex items-center border-b sticky top-0">
                    <button onclick="showScreen('screen-public-home')" class="p-2 text-blue-600 w-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <h2 class="flex-1 text-center text-lg font-semibold text-gray-800">我的匯報紀錄</h2>
                    <div class="w-10"></div>
                </header>
                <div id="report-history-list" class="flex-1 p-4 space-y-4 overflow-y-auto custom-scrollbar">
                    <!-- 動態生成 -->
                </div>
            </div>

            <!-- ======================================== -->
            <!-- 6. 政府部門 - 主頁 -->
            <!-- ======================================== -->
            <div id="screen-gov-home" class="app-screen flex-col h-full bg-gray-50">
                <header class="flex-shrink-0 bg-white p-4 flex items-center border-b">
                    <button onclick="showScreen('screen-gov-login')" class="p-2 text-blue-600 w-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <h2 class="flex-1 text-center text-lg font-semibold text-gray-800">風調雨順(政府部門)</h2>
                    <div class="w-10"></div>
                </header>
                <div class="flex-1 p-6 space-y-4">
                    <button onclick="showScreen('screen-gov-task')" class="w-full bg-white p-6 rounded-lg shadow-md border border-gray-200 flex items-center space-x-4 hover:bg-gray-50 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                        <span class="text-xl font-semibold text-gray-700">跟進工作</span>
                    </button>
                    <button onclick="showScreen('screen-gov-photos')" class="w-full bg-white p-6 rounded-lg shadow-md border border-gray-200 flex items-center space-x-4 hover:bg-gray-50 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-600"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                        <span class="text-xl font-semibold text-gray-700">巡邏相片</span>
                    </button>
                    <!-- (新增) 市民通報按鈕 -->
                    <button onclick="showScreen('screen-gov-public-reports')" class="w-full bg-white p-6 rounded-lg shadow-md border border-gray-200 flex items-center space-x-4 hover:bg-gray-50 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-600">
                            <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                        </svg>
                        <span class="text-xl font-semibold text-gray-700">市民通報</span>
                    </button>
                    <!-- (新增) 無人機巡邏路線按鈕 -->
                    <button onclick="showScreen('screen-gov-drone-route')" class="w-full bg-white p-6 rounded-lg shadow-md border border-gray-200 flex items-center space-x-4 hover:bg-gray-50 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-teal-600">
                            <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
                            <line x1="8" y1="2" x2="8" y2="18"></line>
                            <line x1="16" y1="6" x2="16" y2="22"></line>
                        </svg>
                        <span class="text-xl font-semibold text-gray-700">無人機巡邏路線</span>
                    </button>
                </div>
            </div>

            <!-- ======================================== -->
            <!-- (新增) 政府部門 - 市民通報頁 -->
            <!-- ======================================== -->
            <div id="screen-gov-public-reports" class="app-screen flex-col h-full bg-gray-100">
                <header class="flex-shrink-0 bg-white p-4 flex items-center border-b sticky top-0">
                    <button onclick="showScreen('screen-gov-home')" class="p-2 text-blue-600 w-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <h2 class="flex-1 text-center text-lg font-semibold text-gray-800">市民通報</h2>
                    <div class="w-10"></div>
                </header>
                <div id="gov-public-reports-list" class="flex-1 p-4 space-y-4 overflow-y-auto custom-scrollbar">
                    <!-- 動態生成 -->
                </div>
            </div>

            <!-- ======================================== -->
            <!-- (更新) 政府部門 - 無人機巡邏路線頁 (列表選擇) -->
            <!-- ======================================== -->
            <div id="screen-gov-drone-route" class="app-screen flex-col h-full bg-gray-100">
                <header class="flex-shrink-0 bg-white p-4 flex items-center border-b sticky top-0 z-10">
                    <button onclick="showScreen('screen-gov-home')" class="p-2 text-blue-600 w-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <h2 class="flex-1 text-center text-lg font-semibold text-gray-800">無人機巡邏路線</h2>
                    <div class="w-10"></div>
                </header>
                <div class="flex-1 p-6 flex flex-col">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">選擇巡邏區域</h3>
                    <div class="flex-1 overflow-y-auto custom-scrollbar space-y-3 pb-4">
                        <button onclick="selectPark(this, '西貢東郊野公園')" class="park-btn w-full bg-white p-4 rounded-lg shadow border border-gray-200 text-left hover:bg-blue-50 focus:ring-2 focus:ring-blue-500 transition">
                            <span class="font-semibold text-lg block text-gray-800">西貢東郊野公園</span>
                            <span class="text-sm text-gray-500">Sai Kung East Country Park</span>
                        </button>
                        <button onclick="selectPark(this, '西貢西郊野公園')" class="park-btn w-full bg-white p-4 rounded-lg shadow border border-gray-200 text-left hover:bg-blue-50 focus:ring-2 focus:ring-blue-500 transition">
                            <span class="font-semibold text-lg block text-gray-800">西貢西郊野公園</span>
                            <span class="text-sm text-gray-500">Sai Kung West Country Park</span>
                        </button>
                        <button onclick="selectPark(this, '城門郊野公園')" class="park-btn w-full bg-white p-4 rounded-lg shadow border border-gray-200 text-left hover:bg-blue-50 focus:ring-2 focus:ring-blue-500 transition">
                            <span class="font-semibold text-lg block text-gray-800">城門郊野公園</span>
                            <span class="text-sm text-gray-500">Shing Mun Country Park</span>
                        </button>
                        <button onclick="selectPark(this, '大欖郊野公園')" class="park-btn w-full bg-white p-4 rounded-lg shadow border border-gray-200 text-left hover:bg-blue-50 focus:ring-2 focus:ring-blue-500 transition">
                            <span class="font-semibold text-lg block text-gray-800">大欖郊野公園</span>
                            <span class="text-sm text-gray-500">Tai Lam Country Park</span>
                        </button>
                        <button onclick="selectPark(this, '大帽山郊野公園')" class="park-btn w-full bg-white p-4 rounded-lg shadow border border-gray-200 text-left hover:bg-blue-50 focus:ring-2 focus:ring-blue-500 transition">
                            <span class="font-semibold text-lg block text-gray-800">大帽山郊野公園</span>
                            <span class="text-sm text-gray-500">Tai Mo Shan Country Park</span>
                        </button>
                        <button onclick="selectPark(this, '馬鞍山郊野公園')" class="park-btn w-full bg-white p-4 rounded-lg shadow border border-gray-200 text-left hover:bg-blue-50 focus:ring-2 focus:ring-blue-500 transition">
                            <span class="font-semibold text-lg block text-gray-800">馬鞍山郊野公園</span>
                            <span class="text-sm text-gray-500">Ma On Shan Country Park</span>
                        </button>
                         <button onclick="selectPark(this, '南大嶼郊野公園')" class="park-btn w-full bg-white p-4 rounded-lg shadow border border-gray-200 text-left hover:bg-blue-50 focus:ring-2 focus:ring-blue-500 transition">
                            <span class="font-semibold text-lg block text-gray-800">南大嶼郊野公園</span>
                            <span class="text-sm text-gray-500">Lantau South Country Park</span>
                        </button>
                    </div>
                    
                    <div class="mt-4 p-4 bg-white rounded-xl shadow-lg border border-gray-100">
                         <div id="patrol-status" class="hidden mb-3">
                            <p class="text-sm text-gray-600 mb-1">正在規劃路線: <span id="selected-park-name" class="font-bold text-blue-600"></span></p>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                              <div class="bg-blue-600 h-2.5 rounded-full animate-pulse" style="width: 100%"></div>
                            </div>
                         </div>
                         <button id="start-patrol-btn" onclick="startPatrol()" class="w-full bg-gray-400 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-md cursor-not-allowed transition duration-300" disabled>
                            開始巡邏
                        </button>
                    </div>
                </div>
            </div>

            <!-- ======================================== -->
            <!-- 7. 政府部門 - 跟進工作 -->
            <!-- ======================================== -->
            <div id="screen-gov-task" class="app-screen flex-col h-full bg-gray-100">
                <header class="flex-shrink-0 bg-white p-4 flex items-center border-b sticky top-0 z-10">
                    <button onclick="showScreen('screen-gov-home')" class="p-2 text-blue-600 w-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <h2 class="flex-1 text-center text-lg font-semibold text-gray-800">跟進工作</h2>
                    <div class="w-10"></div>
                </header>
                <div class="flex-1 flex flex-col">
                    <div class="h-64 relative bg-gray-300 flex-shrink-0">
                        <div class="map-iframe-container">
                            <iframe class="map-iframe" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d236184.28886867748!2d113.9168019672615!3d22.35269399436441!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3403f0b26383a375%3A0x83209880ca02b662!2z6aaZ5riv!5e0!3m2!1szh-TW!2shk!4v1729825707483!5m2!1szh-TW!2shk" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                        </div>
                    </div>
                    
                    <div class="p-3 bg-white border-b">
                        <label for="dept-select" class="block text-sm font-medium text-gray-700 mb-1">選擇部門:</label>
                        <select id="dept-select" onchange="updateGovTaskList()" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                            <option value="all">所有部門</option>
                            <option value="dsd">渠務署</option>
                            <option value="lcsd">康樂及文化事務署</option>
                            <option value="fehd">食物環境衛生署</option>
                            <option value="wsd">水務署</option>
                            <option value="cedd">土木工程拓展署</option>
                            <option value="hyd">路政署</option>
                            <option value="td">運輸署</option>
                        </select>
                    </div>

                    <div class="flex-1 overflow-y-auto custom-scrollbar p-2">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-gray-200 sticky top-0">
                                <tr>
                                    <th class="p-2">時間</th>
                                    <th class="p-2">地點</th>
                                    <th class="p-2">情況</th>
                                    <th class="p-2">狀態</th>
                                </tr>
                            </thead>
                            <tbody id="gov-task-list-body" class="bg-white">
                                <!-- JS 生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ======================================== -->
            <!-- 8. 政府部門 - 巡邏相片 -->
            <!-- ======================================== -->
            <div id="screen-gov-photos" class="app-screen flex-col h-full bg-gray-100">
                <!-- ... 保持原樣 ... -->
                 <header class="flex-shrink-0 bg-white p-4 flex items-center border-b sticky top-0">
                    <button onclick="showScreen('screen-gov-home')" class="p-2 text-blue-600 w-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <h2 class="flex-1 text-center text-lg font-semibold text-gray-800">巡邏相片</h2>
                    <div class="w-10"></div>
                </header>
                <div class="flex-1 p-4 overflow-y-auto custom-scrollbar">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white p-2 rounded-lg shadow">
                            <!-- 修改此處: 更換圖片連結 -->
                            <img src="Demo 2" alt="巡邏相片" class="rounded mb-2">
                            <p class="text-xs text-gray-600">地點: 馬鞍山郊野公園</p><p class="text-xs text-gray-500">時間: 3/9 13:58</p><p class="text-sm font-medium text-red-600">分析: 樹木倒塌</p>
                        </div>
                        <div class="bg-white p-2 rounded-lg shadow">
                            <!-- 修改此處: 更換圖片連結 -->
                            <img src="Demo 3" alt="巡邏相片" class="rounded mb-2">
                            <p class="text-xs text-gray-600">地點: 城門郊野公園</p><p class="text-xs text-gray-500">時間: 3/9 12:35</p><p class="text-sm font-medium text-yellow-600">分析: 燈柱歪斜</p>
                        </div>
                         <div class="bg-white p-2 rounded-lg shadow">
                            <!-- 修改此處: 更換圖片連結 -->
                            <img src="Demo 1" alt="巡邏相片" class="rounded mb-2">
                            <p class="text-xs text-gray-600">地點: 馬鞍山郊野公園</p><p class="text-xs text-gray-500">時間: 3/9 09:12</p><p class="text-sm font-medium text-red-600">分析: 燈柱歪斜</p>
                        </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ======================================== -->
            <!-- 9. 政府部門 - 問題詳細頁 -->
            <!-- ======================================== -->
            <div id="screen-gov-task-details" class="app-screen flex-col h-full bg-gray-100">
                 <header class="flex-shrink-0 bg-white p-4 flex items-center border-b sticky top-0 z-10">
                    <button onclick="showScreen('screen-gov-task')" class="p-2 text-blue-600 w-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <h2 class="flex-1 text-center text-lg font-semibold text-gray-800">問題詳情</h2>
                    <div class="w-10"></div>
                </header>
                <div class="flex-1 p-4 space-y-4 overflow-y-auto custom-scrollbar">
                    <h3 id="detail-title" class="text-2xl font-bold text-gray-800">...</h3>
                    
                    <div class="bg-white rounded-lg shadow p-4">
                        <h4 class="text-lg font-semibold mb-2">無人機巡邏相片</h4>
                        <!-- 修改此處: 更換圖片連結 -->
                        <img id="detail-drone-photo" src="https://placehold.co/400x250/666/fff?text=Drone+Photo" alt="無人機相片" class="rounded-lg w-full">
                    </div>
                    
                    <div class="bg-white rounded-lg shadow p-4">
                        <h4 class="text-lg font-semibold mb-2">詳細資料</h4>
                        <div class="space-y-2">
                            <div>
                                <span class="font-medium text-gray-600">目前狀態:</span>
                                <span id="detail-status" class="font-bold text-lg ml-2">...</span>
                            </div>
                            <div>
                                <span class="font-medium text-gray-600">負責部門:</span>
                                <span id="detail-dept" class="ml-2">...</span>
                            </div>
                            <div>
                                <span class="font-medium text-gray-600">時間:</span>
                                <span id="detail-time" class="ml-2">...</span>
                            </div>
                        </div>
                    </div>

                    <div id="detail-public-report-section" class="bg-white rounded-lg shadow p-4 hidden">
                        <h4 class="text-lg font-semibold mb-2">公眾匯報相片</h4>
                        <!-- 修改此處: 更換圖片連結 -->
                        <img id="detail-public-photo" src="https://placehold.co/400x250/ccc/fff?text=Public+Photo" alt="公眾匯報相片" class="rounded-lg w-full">
                    </div>
                    
                    <div class="space-y-3 pt-4">
                        <button onclick="updateTaskStatus('處理中')" class="w-full bg-yellow-500 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-md hover:bg-yellow-600 transition">
                            標記為「處理中」
                        </button>
                        <button onclick="updateTaskStatus('已完成')" class="w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-md hover:bg-green-700 transition">
                            標記為「已完成」
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // 頁面導航邏輯
        let currentScreen = 'screen-login';
        
        // 數據變數
        let myReports = []; // 儲存公眾匯報
        // 預設一些市民匯報數據以供展示
        // 修改此處: 可將 'photo' 屬性改為您的本地圖片路徑
        let citizenReports = [
            {
                photo: 'Tree1.jpg',
                type: '樹木倒塌',
                description: '大樹倒在路中間，阻礙交通',
                region: '九龍',
                district: '黃大仙區',
                status: '待處理',
                time: '11:02'
            },
            {
                photo: 'Water1.png',
                type: '嚴重水浸',
                description: '行人隧道水浸嚴重',
                region: '新界',
                district: '沙田區',
                status: '待處理',
                time: '19:45'
            }
        ];
        
        let allTasks = {}; 
        let currentViewingTaskId = null; 
        
        // 地區數據
        const districtsData = {
            "香港島": ["中西區", "灣仔區", "東區", "南區"],
            "九龍": ["油尖旺區", "深水埗區", "九龍城區", "黃大仙區", "觀塘區"],
            "新界": ["葵青區", "荃灣區", "屯門區", "元朗區", "北區", "大埔區", "沙田區", "西貢區", "離島區"]
        };

        // 修改此處: dronePhoto 屬性可改為您的圖片連結
        const departmentTasks = {
            'dsd': [
                { id: 'dsd-01', time: '3/9 09:25', location: '大埔寶鄉街', situation: '渠口堵塞', priority: '!', status: '待處理', dronePhoto: 'https://placehold.co/300x200/94a3b8/fff?text=Drone+Photo+5', publicPhoto: null, dept: '渠務署' }
            ],
            'wsd': [
                { id: 'wsd-01', time: '3/9 14:00', location: '黃大仙區龍翔道', situation: '嚴重水浸', priority: '!!!', status: '待處理', dronePhoto: 'https://placehold.co/300x200/94a3b8/fff?text=Drone+Photo+1', publicPhoto: null, dept: '水務署' }
            ],
            'cedd': [
                { id: 'cedd-01', time: '3/9 12:40', location: '淺水灣道', situation: '山泥傾瀉', priority: '!!', status: '處理中', dronePhoto: 'https://placehold.co/300x200/94a3b8/fff?text=Drone+Photo+2', publicPhoto: null, dept: '土木工程拓展署' }
            ],
            'td': [
                { id: 'td-01', time: '3/9 09:15', location: '元朗青山公路', situation: '樹木倒塌', priority: '!!!', status: '待處理', dronePhoto: 'https://placehold.co/300x200/94a3b8/fff?text=Drone+Photo+3', publicPhoto: 'https://placehold.co/400x250/ccc/fff?text=Public+Photo+1', dept: '運輸署' }
            ],
            'hyd': [
                { id: 'hyd-01', time: '3/9 08:30', location: '天水圍天耀路', situation: '燈柱歪斜', priority: '!!', status: '已完成', dronePhoto: 'https://placehold.co/300x200/94a3b8/fff?text=Drone+Photo+4', publicPhoto: null, dept: '路政署' }
            ],
            'lcsd': [],
            'fehd': []
        };


        function showScreen(screenId) {
            const oldScreen = document.getElementById(currentScreen);
            if (oldScreen) oldScreen.classList.remove('active');
            
            const newScreen = document.getElementById(screenId);
            if (newScreen) {
                newScreen.classList.add('active');
                currentScreen = screenId;

                if (screenId === 'screen-gov-task') {
                    updateGovTaskList(); 
                }
                if (screenId === 'screen-report-history') {
                    updateReportHistory();
                }
                if (screenId === 'screen-gov-public-reports') {
                    updateGovPublicReportsList();
                }
            } else {
                console.error("Screen not found:", screenId);
            }
        }

        function previewPhoto(event) {
            const preview = document.getElementById('photo-preview');
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="相片預覽" class="w-full h-full object-cover rounded-lg">`;
                }
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = '(相片預覽)';
            }
        }

        // (更新) 地區連動邏輯
        function updateDistricts() {
            const regionSelect = document.getElementById('region-select');
            const districtSelect = document.getElementById('district-select');
            const selectedRegion = regionSelect.value;
            
            // 清空地區選項
            districtSelect.innerHTML = '<option value="">請選擇</option>';
            
            if (selectedRegion && districtsData[selectedRegion]) {
                districtsData[selectedRegion].forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
                districtSelect.disabled = false;
            } else {
                districtSelect.disabled = true;
                districtSelect.innerHTML = '<option value="">請先選區域</option>';
            }
        }

        function submitReport() {
            const photoPreview = document.getElementById('photo-preview');
            const photoSrc = photoPreview.querySelector('img') ? photoPreview.querySelector('img').src : 'https://placehold.co/200x200/ccc/fff?text=No+Photo';
            const problemTypeSelect = document.getElementById('report-problem-type');
            const problemType = problemTypeSelect.options[problemTypeSelect.selectedIndex].text;
            const description = document.getElementById('report-textarea').value || '(沒有描述)';
            
            const region = document.getElementById('region-select').value;
            const district = document.getElementById('district-select').value;
            
            if (!region || !district) {
                alert("請選擇區域及地區");
                return;
            }

            // 儲存到我的匯報紀錄
            const newReport = {
                photo: photoSrc,
                type: problemType,
                description: description,
                region: region,
                district: district,
                status: '待處理',
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };
            
            myReports.push(newReport);
            // 同時推送到政府的市民通報列表 (模擬後端同步)
            citizenReports.unshift(newReport);

            // 清空表單
            document.getElementById('report-textarea').value = '';
            photoPreview.innerHTML = '(相片預覽)';
            document.getElementById('photo-upload').value = null;
            document.getElementById('region-select').value = '';
            updateDistricts(); // 重置地區選單
            
            showScreen('screen-report-success');

            setTimeout(() => {
                showScreen('screen-public-home');
            }, 2000);
        }
        
        function updateReportHistory() {
            const listDiv = document.getElementById('report-history-list');
            listDiv.innerHTML = ''; 

            if (myReports.length === 0) {
                listDiv.innerHTML = `<p class="text-center text-gray-500 mt-8">您尚未提交任何匯報。</p>`;
                return;
            }

            [...myReports].reverse().forEach(report => {
                let statusClass = 'text-yellow-600 bg-yellow-100';
                if (report.status === '處理中') statusClass = 'text-blue-600 bg-blue-100';
                if (report.status === '已完成') statusClass = 'text-green-600 bg-green-100';

                const cardHTML = `
                    <div class="bg-white rounded-lg shadow p-4 flex items-center space-x-4">
                        <img src="${report.photo}" alt="匯報相片" class="w-20 h-20 object-cover rounded-lg flex-shrink-0">
                        <div class="flex-1 min-w-0">
                            <h3 class="font-semibold text-gray-800">${report.type}</h3>
                            <p class="text-sm text-gray-600">${report.region} - ${report.district}</p>
                            <p class="text-sm text-gray-500 truncate">${report.description}</p>
                        </div>
                        <span class="text-xs font-medium ${statusClass} px-2 py-1 rounded-full whitespace-nowrap">${report.status}</span>
                    </div>
                `;
                listDiv.innerHTML += cardHTML;
            });
        }
        
        // (新增) 更新政府市民通報列表
        function updateGovPublicReportsList() {
            const listDiv = document.getElementById('gov-public-reports-list');
            listDiv.innerHTML = '';

            if (citizenReports.length === 0) {
                listDiv.innerHTML = `<p class="text-center text-gray-500 mt-8">目前沒有市民通報。</p>`;
                return;
            }

            citizenReports.forEach(report => {
                 const cardHTML = `
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="flex items-start space-x-4">
                            <img src="${report.photo}" alt="匯報相片" class="w-24 h-24 object-cover rounded-lg flex-shrink-0">
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-gray-800 text-lg">${report.type}</h3>
                                    <span class="text-xs text-gray-500">${report.time}</span>
                                </div>
                                <p class="text-sm text-blue-600 font-medium mt-1">${report.region} > ${report.district}</p>
                                <p class="text-sm text-gray-600 mt-2">${report.description}</p>
                            </div>
                        </div>
                        <div class="mt-3 pt-3 border-t border-gray-100 flex justify-end space-x-2">
                             <button class="px-3 py-1 text-xs bg-gray-200 rounded hover:bg-gray-300">忽略</button>
                             <button class="px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">立案跟進</button>
                        </div>
                    </div>
                `;
                listDiv.innerHTML += cardHTML;
            });
        }

        function flattenTasks() {
            allTasks = {};
            Object.keys(departmentTasks).forEach(deptKey => {
                departmentTasks[deptKey].forEach(task => {
                    allTasks[task.id] = task;
                });
            });
        }

        function updateGovTaskList() {
            const selectedDept = document.getElementById('dept-select').value;
            const taskListBody = document.getElementById('gov-task-list-body');
            taskListBody.innerHTML = '';
            
            let tasksToShow = [];

            if (selectedDept === 'all') {
                Object.keys(departmentTasks).forEach(deptKey => {
                    tasksToShow = tasksToShow.concat(departmentTasks[deptKey]);
                });
            } else if (departmentTasks[selectedDept]) {
                tasksToShow = departmentTasks[selectedDept];
            }

            if (tasksToShow.length > 0) {
                tasksToShow.forEach(task => {
                    let statusText = task.status;
                    let statusClass = 'text-yellow-600';
                    if (task.status === '處理中') statusClass = 'text-blue-600';
                    if (task.status === '已完成') statusClass = 'text-green-600';

                    const row = `
                        <tr class="task-row border-b" onclick="showTaskDetails('${task.id}')">
                            <td class="p-2">${task.time}</td>
                            <td class="p-2">${task.location}</td>
                            <td class="p-2">${task.situation}</td>
                            <td class="p-2"><span class="${statusClass} font-semibold">${statusText}</span></td>
                        </tr>
                    `;
                    taskListBody.innerHTML += row;
                });
            } else {
                taskListBody.innerHTML = `<tr class="border-b"><td class="p-4 text-center text-gray-500" colspan="4">此部門目前沒有待處理任務</td></tr>`;
            }
        }
        
        function showTaskDetails(taskId) {
            currentViewingTaskId = taskId;
            const task = allTasks[taskId];
            if (!task) return;

            document.getElementById('detail-title').innerText = `${task.situation} (${task.location})`;
            document.getElementById('detail-drone-photo').src = task.dronePhoto;
            
            let statusText = task.status;
            let statusClass = 'text-yellow-600';
            if (task.status === '處理中') { statusClass = 'text-blue-600'; }
            if (task.status === '已完成') { statusClass = 'text-green-600'; }
            const statusEl = document.getElementById('detail-status');
            statusEl.innerText = statusText;
            statusEl.className = `font-bold text-lg ml-2 ${statusClass}`;
            
            document.getElementById('detail-dept').innerText = task.dept;
            document.getElementById('detail-time').innerText = task.time;

            const publicSection = document.getElementById('detail-public-report-section');
            if (task.publicPhoto) {
                document.getElementById('detail-public-photo').src = task.publicPhoto;
                publicSection.classList.remove('hidden');
            } else {
                publicSection.classList.add('hidden');
            }
            
            showScreen('screen-gov-task-details');
        }
        
        function updateTaskStatus(newStatus) {
            if (!currentViewingTaskId) return;
            
            const task = allTasks[currentViewingTaskId];
            task.status = newStatus;
            
            showScreen('screen-gov-task');
        }
        
        // (新增) 郊野公園選擇邏輯
        let selectedPark = null;

        function selectPark(element, parkName) {
            // 移除舊的選擇樣式
            document.querySelectorAll('.park-btn').forEach(btn => {
                btn.classList.remove('selected', 'bg-blue-50', 'ring-2', 'ring-blue-500');
            });
            
            // 添加新的選擇樣式
            element.classList.add('selected', 'bg-blue-50', 'ring-2', 'ring-blue-500');
            
            selectedPark = parkName;
            document.getElementById('start-patrol-btn').disabled = false;
            document.getElementById('start-patrol-btn').classList.remove('bg-gray-400', 'cursor-not-allowed');
            document.getElementById('start-patrol-btn').classList.add('bg-blue-600', 'hover:bg-blue-700');
        }
        
        function startPatrol() {
            if (!selectedPark) return;
            
            // 顯示狀態
            const statusDiv = document.getElementById('patrol-status');
            const startBtn = document.getElementById('start-patrol-btn');
            const parkNameSpan = document.getElementById('selected-park-name');
            
            parkNameSpan.textContent = selectedPark;
            statusDiv.classList.remove('hidden');
            
            // 禁用按鈕
            startBtn.disabled = true;
            startBtn.textContent = '巡邏已啟動...';
            startBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
            startBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            
            // 模擬 3 秒後巡邏完成或回報 (這裡僅做模擬)
            setTimeout(() => {
                startBtn.textContent = '巡邏進行中';
            }, 3000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.app-screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById('screen-login').classList.add('active');
            
            flattenTasks();
            updateGovTaskList();
        });
    </script>
</body>
</html>
